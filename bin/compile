#!/bin/sh

set -e

BUILD_DIR=$1
CACHE_DIR=$2

# config
VERSION="0.9.5"

# Buildpack URL
SLIMERJS_ARCHIVE_NAME=slimerjs-${VERSION}
SLIMERJS_BINARIES_URL=http://download.slimerjs.org/releases/${VERSION}/${SLIMERJS_ARCHIVE_NAME}-linux-x86_64.tar.bz2

echo "-----> Fetching and extracting SlimerJS binaries"
mkdir -p $BUILD_DIR/vendor
curl -s $SLIMERJS_BINARIES_URL | tar xj -C $CACHE_DIR
mv $CACHE_DIR/$SLIMERJS_ARCHIVE_NAME $BUILD_DIR/vendor/slimerjs

echo "-----> exporting PATH and LIBRARY_PATH"
PROFILE_PATH="$BUILD_DIR/.profile.d/slimerjs.sh"
mkdir -p $(dirname $PROFILE_PATH)
echo 'export PATH="$PATH:/app/vendor/slimerjs"' >> $PROFILE_PATH
